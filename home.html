<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng qu·∫£n l√Ω ƒë∆°n h√†ng</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .home-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .home-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .home-header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.2em;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .menu-card {
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s;
            display: block;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            text-decoration: none;
            color: white;
        }
        
        .menu-card.extract { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .menu-card.inventory { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .menu-card.reports { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .menu-card.settings { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .menu-card.labels { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .menu-card.employees { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        
        .card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }
        
        .card-title-menu {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .card-desc {
            font-size: 1em;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .quick-info {
            text-align: center;
            margin-top: 30px;
            color: #666;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 8px;
        }
        
        .status-message {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b6d4db;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            text-align: center;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .home-container {
                padding: 20px 10px;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .home-header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="home-container">
        <div class="home-header">
            <h1>üè¢ H·ªá th·ªëng qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
            <p class="subtitle">Ch·ªçn ch·ª©c nƒÉng b·∫°n mu·ªën s·ª≠ d·ª•ng</p>
        </div>
        
        <div id="statusMessage" class="status-message">
            üöÄ ƒêang kh·ªüi t·∫°o h·ªá th·ªëng...
        </div>
        
        <div class="menu-grid">
            <div class="menu-card extract" onclick="navigateToPage('extract-orders')">
                <span class="card-icon">üì¶</span>
                <div class="card-title-menu">Tr√≠ch xu·∫•t ƒë∆°n h√†ng</div>
                <div class="card-desc">T√¨m ki·∫øm v√† qu·∫£n l√Ω ƒë∆°n h√†ng theo kho·∫£ng th·ªùi gian, c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë√≥ng g√≥i</div>
            </div>
            
            <div class="menu-card labels" onclick="navigateToPage('shipping-labels')">
                <span class="card-icon">üè∑Ô∏è</span>
                <div class="card-title-menu">In tem v·∫≠n chuy·ªÉn</div>
                <div class="card-desc">T·∫°o v√† in tem shipping labels t·ª´ d·ªØ li·ªáu Google Sheets, layout t·ªëi ∆∞u cho in A4</div>
            </div>
            
            <div class="menu-card labels" onclick="navigateToPage('label-script')" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                <span class="card-icon">üè∑Ô∏è</span>
                <div class="card-title-menu">In nh√£n g·ª≠i h√†ng</div>
                <div class="card-desc">C√¥ng c·ª• n√¢ng cao ƒë·ªÉ x·ª≠ l√Ω v√† t√πy ch·ªânh shipping labels t·ª´ nhi·ªÅu sheet kh√°c nhau</div>
            </div>
            
            <div class="menu-card employees" onclick="navigateToPage('employee-tasks')">
                <span class="card-icon">üë•</span>
                <div class="card-title-menu">Giao vi·ªác nh√¢n vi√™n</div>
                <div class="card-desc">Qu·∫£n l√Ω v√† theo d√µi c√¥ng vi·ªác ƒë∆∞·ª£c giao cho t·ª´ng nh√¢n vi√™n, c·∫≠p nh·∫≠t tr·∫°ng th√°i ho√†n th√†nh</div>
            </div>
            
            <div class="menu-card inventory" onclick="navigateToPage('inventory')">
                <span class="card-icon">üìä</span>
                <div class="card-title-menu">Qu·∫£n l√Ω kho</div>
                <div class="card-desc">Theo d√µi t·ªìn kho, c·∫£nh b√°o h·∫øt h√†ng, qu·∫£n l√Ω nh·∫≠p xu·∫•t</div>
            </div>
            
            <div class="menu-card reports" onclick="navigateToPage('reports')">
                <span class="card-icon">üìà</span>
                <div class="card-title-menu">B√°o c√°o</div>
                <div class="card-desc">T·∫°o c√°c b√°o c√°o doanh thu, th·ªëng k√™ b√°n h√†ng, ph√¢n t√≠ch d·ªØ li·ªáu</div>
            </div>
            
            <div class="menu-card settings" onclick="navigateToPage('settings')">
                <span class="card-icon">‚öôÔ∏è</span>
                <div class="card-title-menu">C√†i ƒë·∫∑t</div>
                <div class="card-desc">C·∫•u h√¨nh h·ªá th·ªëng, qu·∫£n l√Ω ng∆∞·ªùi d√πng, thi·∫øt l·∫≠p th√¥ng b√°o</div>
            </div>
        </div>
        
        <div class="quick-info">
            <div><strong>üìç Phi√™n b·∫£n:</strong> v2.0 - Google Apps Script Web App</div>
            <div style="font-size: 0.9em; margin-top: 10px;">
                <strong>üéØ Navigation:</strong> Simple & Reliable | <strong>üîß Status:</strong> <span id="navStatus">ƒêang ki·ªÉm tra...</span>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 40px; color: #666;">
            <p>¬© 2025 H·ªá th·ªëng qu·∫£n l√Ω ph√≤ng ban. Powered by Google Apps Script.</p>
        </div>
    </div>

    <script>
        // Get the correct deployment URL from address bar
        function getCorrectDeploymentUrl() {
            // Method 1: Check if manually set
            const manualUrl = localStorage.getItem('manualDeploymentUrl');
            if (manualUrl) {
                console.log('Using manual deployment URL:', manualUrl);
                return manualUrl;
            }
            
            // Method 2: Try to get from parent window (if in iframe)
            try {
                if (window.parent && window.parent !== window) {
                    const parentUrl = window.parent.location.href;
                    if (parentUrl.includes('script.google.com/macros')) {
                        console.log('Got URL from parent:', parentUrl);
                        // Convert /dev to /exec for production
                        const productionUrl = parentUrl.replace('/dev', '/exec').split('?')[0];
                        console.log('Converted to production URL:', productionUrl);
                        return productionUrl;
                    }
                }
            } catch (e) {
                console.log('Cannot access parent URL due to CORS');
            }
            
            // Method 3: Try to get from document.referrer
            if (document.referrer && document.referrer.includes('script.google.com/macros')) {
                console.log('Got URL from referrer:', document.referrer);
                // Convert /dev to /exec for production
                const productionUrl = document.referrer.replace('/dev', '/exec').split('?')[0];
                console.log('Converted referrer to production URL:', productionUrl);
                return productionUrl;
            }
            
            // Method 4: Use your production deployment URL as fallback
            const productionDeploymentUrl = 'https://script.google.com/macros/s/AKfycbz4RmUTpx0jIeRgX4KmNIqXOFsEiHd20Ixgev2ZfYN2tghfZeNP3KAk5ff1f10klupF/exec';
            console.log('Using production deployment URL fallback:', productionDeploymentUrl);
            return productionDeploymentUrl;
        }

        // Simple and reliable navigation function
        function navigateToPage(page) {
            // Show loading feedback
            showStatusMessage(`üîÑ ƒêang chuy·ªÉn ƒë·∫øn ${getPageTitle(page)}...`, 'loading');
            
            // Get the correct deployment URL
            const deploymentUrl = getCorrectDeploymentUrl();
            const newUrl = `${deploymentUrl}?page=${page}`;
            
            console.log('Current location.href:', window.location.href);
            console.log('Deployment URL:', deploymentUrl);
            console.log('Navigating to:', newUrl);
            
            // Navigate immediately
            try {
                // Use top window to navigate (breaks out of iframe if needed)
                if (window.top && window.top !== window) {
                    window.top.location.href = newUrl;
                } else {
                    window.location.href = newUrl;
                }
            } catch (error) {
                showStatusMessage(`‚ùå L·ªói ƒëi·ªÅu h∆∞·ªõng: ${error.message}`, 'error');
                console.error('Navigation error:', error);
                
                // Fallback: try alternative methods
                try {
                    window.open(newUrl, '_self');
                } catch (e2) {
                    showStatusMessage(`‚ùå C·∫ßn m·ªü link th·ªß c√¥ng: ${newUrl}`, 'error');
                }
            }
        }
        
        // Get page title for display
        function getPageTitle(page) {
            const titles = {
                'extract-orders': 'Tr√≠ch xu·∫•t ƒë∆°n h√†ng',
                'shipping-labels': 'In tem v·∫≠n chuy·ªÉn',
                'label-script': 'Label Script',
                'employee-tasks': 'Giao vi·ªác nh√¢n vi√™n',
                'inventory': 'Qu·∫£n l√Ω kho',
                'reports': 'B√°o c√°o',
                'settings': 'C√†i ƒë·∫∑t'
            };
            return titles[page] || page;
        }
        
        // Show status message
        function showStatusMessage(message, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            const typeClass = {
                'loading': 'background: #d1ecf1; color: #0c5460; border-color: #b6d4db;',
                'success': 'background: #d4edda; color: #155724; border-color: #c3e6cb;',
                'error': 'background: #f8d7da; color: #721c24; border-color: #f5c6cb;',
                'info': 'background: #d1ecf1; color: #0c5460; border-color: #b6d4db;'
            };
            
            statusDiv.innerHTML = message;
            statusDiv.style.cssText = `
                ${typeClass[type]}
                padding: 15px;
                border-radius: 6px;
                margin: 20px 0;
                text-align: center;
                border: 1px solid;
                display: block;
            `;
        }
        
        // Check navigation status
        function checkNavigationStatus() {
            try {
                const currentLocationUrl = window.location.href;
                const deploymentUrl = getCorrectDeploymentUrl();
                const isDevEnvironment = currentLocationUrl.includes('/dev');
                const isProductionUrl = deploymentUrl.includes('/exec');
                
                console.log('JavaScript location.href:', currentLocationUrl);
                console.log('Production deployment URL:', deploymentUrl);
                console.log('Environment:', isDevEnvironment ? 'Development (/dev)' : 'Production');
                
                // Show both URLs for comparison
                const urlInfo = document.querySelector('.quick-info');
                if (urlInfo) {
                    urlInfo.innerHTML = `
                        <div><strong>üìç Current environment:</strong></div>
                        <div style="font-family: monospace; font-size: 0.8em; background: ${isDevEnvironment ? '#fff3cd' : '#d4edda'}; padding: 8px; border-radius: 4px; margin: 8px 0; word-break: break-all; color: ${isDevEnvironment ? '#856404' : '#155724'};">
                            ${currentLocationUrl} ${isDevEnvironment ? '(DEV)' : '(PROD)'}
                        </div>
                        <div><strong>üéØ Navigation target (Production):</strong></div>
                        <div style="font-family: monospace; font-size: 0.8em; background: #e8f5e8; padding: 8px; border-radius: 4px; margin: 8px 0; word-break: break-all; color: #2e7d32;">
                            ${deploymentUrl}
                        </div>
                        <div style="font-size: 0.9em; margin-top: 10px;">
                            <strong>üîß Status:</strong> <span style="color: #28a745;">Production URL ready</span> |
                            <strong>üì± Auto-convert:</strong> /dev ‚Üí /exec
                        </div>
                    `;
                }
                
                if (isDevEnvironment) {
                    showStatusMessage('üîß ƒêang test trong m√¥i tr∆∞·ªùng DEV. Navigation s·∫Ω chuy·ªÉn sang PRODUCTION URL.', 'info');
                } else {
                    showStatusMessage('‚úÖ H·ªá th·ªëng s·∫µn s√†ng! ƒêang d√πng Production URL.', 'success');
                }
                
            } catch (error) {
                console.error('Status check error:', error);
                showStatusMessage('‚ö†Ô∏è L·ªói ki·ªÉm tra tr·∫°ng th√°i: ' + error.message, 'error');
            }
        }
        
        // Add keyboard shortcuts (optional enhancement)
        function setupKeyboardShortcuts() {
            const shortcuts = {
                '1': 'extract-orders',
                '2': 'shipping-labels', 
                '3': 'employee-tasks',
                '4': 'inventory',
                '5': 'reports',
                '6': 'settings'
            };
            
            document.addEventListener('keydown', function(e) {
                if (e.altKey && shortcuts[e.key]) {
                    e.preventDefault();
                    navigateToPage(shortcuts[e.key]);
                }
            });
        }
        
        // Add visual feedback for interactions
        function addVisualFeedback() {
            const cards = document.querySelectorAll('.menu-card');
            cards.forEach((card, index) => {
                // Add tooltip
                card.title = `Click ƒë·ªÉ m·ªü ho·∫∑c nh·∫•n Alt+${index + 1}`;
                
                // Add click feedback
                card.addEventListener('mousedown', function() {
                    this.style.transform = 'translateY(-3px) scale(0.98)';
                });
                
                card.addEventListener('mouseup', function() {
                    this.style.transform = 'translateY(-5px) scale(1)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = '';
                });
            });
        }
        
        // Initialize page
        function initializePage() {
            console.log('üè† Initializing Home Page...');
            
            // Check navigation status
            setTimeout(checkNavigationStatus, 500);
            
            // Setup enhancements
            setupKeyboardShortcuts();
            addVisualFeedback();
            
            console.log('‚úÖ Home page ready');
        }
        
        // Run when page loads
        window.addEventListener('load', initializePage);
        
        // Also run on DOM ready as fallback
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }
        
        // Debug helper - Enhanced for your deployment
        window.debugNavigation = function() {
            console.log('üîç Navigation Debug Info:');
            console.log('JavaScript location.href:', window.location.href);
            console.log('Actual deployment URL:', getCorrectDeploymentUrl());
            console.log('Document referrer:', document.referrer);
            
            // Try to access parent
            try {
                if (window.parent && window.parent !== window) {
                    console.log('Parent URL:', window.parent.location.href);
                } else {
                    console.log('No parent window or same as current');
                }
            } catch (e) {
                console.log('Cannot access parent due to CORS:', e.message);
            }
            
            // Test URL construction
            const testPage = 'shipping-labels';
            const deploymentUrl = getCorrectDeploymentUrl();
            const testUrl = `${deploymentUrl}?page=${testPage}`;
            console.log(`Test URL for ${testPage}:`, testUrl);
            
            return {
                jsLocation: window.location.href,
                deployment: deploymentUrl,
                referrer: document.referrer,
                testUrl: testUrl
            };
        };
        
        // Quick test function
        window.testNavigation = function(page = 'shipping-labels') {
            console.log(`üß™ Testing navigation to: ${page}`);
            const deploymentUrl = getCorrectDeploymentUrl();
            const testUrl = `${deploymentUrl}?page=${page}`;
            console.log('Will navigate to:', testUrl);
            
            if (confirm(`Test navigation to: ${testUrl}?`)) {
                if (window.top && window.top !== window) {
                    window.top.location.href = testUrl;
                } else {
                    window.location.href = testUrl;
                }
            }
        };
        
        // Manual URL setter (if needed)
        window.setDeploymentUrl = function(url) {
            if (!url) {
                url = prompt('Nh·∫≠p deployment URL:', 'https://script.google.com/macros/s/AKfycbz4RmUTpx0jIeRgX4KmNIqXOFsEiHd20Ixgev2ZfYN2tghfZeNP3KAk5ff1f10klupF/dev');
            }
            
            if (url && url.includes('script.google.com/macros')) {
                localStorage.setItem('manualDeploymentUrl', url);
                console.log('Saved manual deployment URL:', url);
                checkNavigationStatus();
                showStatusMessage('‚úÖ ƒê√£ l∆∞u deployment URL th·ªß c√¥ng!', 'success');
            } else {
                alert('URL kh√¥ng h·ª£p l·ªá!');
            }
        };
    </script>
</body>
</html>